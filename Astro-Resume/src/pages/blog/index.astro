---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type BlogEntry = CollectionEntry<"blog">;
const posts = await getCollection("blog");
const sorted = (posts as BlogEntry[]).sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

// Ensure BASE always has a trailing slash
const BASE = import.meta.env.BASE_URL.endsWith("/")
    ? import.meta.env.BASE_URL
    : import.meta.env.BASE_URL + "/";
---

<BaseLayout title="Blog — Daniël van Leeuwen">
    <main class="blog-index">
        <h1>Dev Logs &amp; Project Notes</h1>
        <ul>
            {
                sorted.map((post) => {
                    const { slug, data } = post as BlogEntry;
                    return (
                        <li>
                            <a href={`${BASE}blog/${slug}/`}>
                                <h2>{data.title}</h2>
                            </a>

                            {data.description && <p>{data.description}</p>}
                            <small>
                                {data.date.toLocaleDateString("nl-NL")}
                            </small>
                        </li>
                    );
                })
            }
        </ul>
    </main>
</BaseLayout>
